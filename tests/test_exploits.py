#!/usr/bin/env python3
# Exploit Testing

import unittest

class TestExploits(unittest.TestCase):
    def test_v8_exploit_generation(self):
        """اختبار توليد ثغرة V8"""
        from exploits.zero_click_web import ZeroClickExploit
        
        exploit = ZeroClickExploit.generate_v8_exploit()
        self.assertIsInstance(exploit, str)
        self.assertIn('<script>', exploit)
        self.assertIn('Array.prototype.sort', exploit)
        
    def test_apk_injection(self):
        """اختبار حقن APK"""
        from payloads.apk_weaponizer import APKWeaponizer
        
        weaponizer = APKWeaponizer()
        smali_code = weaponizer.get_coin_injector_smali()
        
        self.assertIn('.class', smali_code)
        self.assertIn('injectCoins', smali_code)
        
    def test_encryption(self):
        """اختبار التشفير"""
        from exfiltration.encrypted_storage import EncryptedStorage
        
        storage = EncryptedStorage(':memory:')
        test_data = {'test': 'data', 'coins': 1000}
        
        record_id = storage.store_encrypted('test', test_data)
        self.assertIsNotNone(record_id)
